\newpage
\chapter{Theory}

\section{2D Magnetodynamic equations}

\noindent Cartesian coordinate system $(x,y,z)$

\begin{equation} \label{eq:1}
\nabla \times \left( \frac{1}{\mu} \left( \nabla \times \bm{A} \right) \right) + \gamma \frac{\partial \bm{A}}{\partial t} - \gamma \left( \bm{v} \times \left( \nabla \times \bm{A} \right) \right) = \bm{J}
\end{equation}


\begin{align*} 
\bm{A} &= \left(0,0,A_z\right) \numberthis \label{eq:2} \\
\bm{J} &= \left(0,0,J_z\right) \numberthis \label{eq:3} \\
\bm{v} &= \left(v_x,v_y,0\right) \numberthis \label{eq:4} \\
\bm{B} &= \nabla \times \bm{A} = \left(\partial_y A_x,-\partial_x A_y,0\right) = \left(B_x,B_y,0\right) \numberthis \label{eq:5} \\
\bm{v} \times \bm{B} &= \left(0,0,v_x B_y - v_y B_x\right) \numberthis \label{eq:6}
\end{align*}

\begin{align*}
\bm{A}, \bm{J}, \bm{v}  &= f\left(x,y,t\right) \numberthis \label{eq:7} \\
\mathrm{Linear} \quad \mu, \gamma  &= f\left(x,y\right) \qquad \mathrm{Nonlinear} \quad \mu = f\left(x,y, ||\bm{B}||\right) \numberthis \label{eq:8}
\end{align*}

\section{Boundary condition}

\begin{equation} \label{eq:9} 
A_z\bigg\rvert_{\partial \Omega} = 0
\end{equation}

\section{Initial condition}

\begin{equation} \label{eq:10} 
A_z\bigg\rvert_{t=0} = 0
\end{equation}


\section{Force}

\begin{equation} \label{eq:11} 
T_{ij} = \frac{1}{\mu_0} \left(B_i B_j - \frac{1}{2} B^2 \delta_{ij}\right)
\end{equation}

\begin{equation} \label{eq:12} 
\mathbb{T} = \frac{1}{\mu_0} \begin{pmatrix}
B_x B_x & B_x B_y \\
B_y B_x & B_y B_y \\
\end{pmatrix} - \frac{1}{2\mu_0} \begin{pmatrix}
B_x^2 + B_y^2 & 0 \\
0 & B_x^2 + B_y^2 \\
\end{pmatrix}
\end{equation}

\begin{align*}
\mathrm{3D} \qquad &\bm{F}\left(x,y,z\right) = \oint_{\partial \Omega} \mathbb{T}  \,\mathrm{d}\bm{S} = \int_{\Omega} \left( \nabla \cdot \mathbb{T} \right) \,\mathrm{d}V \numberthis \label{eq:13} \\
\mathrm{2D} \qquad &\bm{F}\left(x,y\right) = L \oint_{\partial \Omega} \mathbb{T}  \,\mathrm{d}\bm{l} = L \int_{\Omega} \left( \nabla \cdot \mathbb{T} \right) \,\mathrm{d}S \numberthis \label{eq:14} \\
\end{align*}

\begin{equation} \label{eq:15} 
\nabla \cdot \mathbb{T} = \frac{1}{\mu_0} \left(\partial_x,\partial_y\right) \begin{pmatrix}
\frac{1}{2} \left(B_x^2 - B_y^2 \right) & B_x B_y \\
B_y B_x & \frac{1}{2} \left(B_y^2 - B_x^2 \right) \\
\end{pmatrix}
\end{equation}

\begin{equation} \label{eq:16} 
\nabla \cdot \mathbb{T} = \frac{1}{\mu_0} \left(\frac{1}{2} \partial_x \left(B_x^2 - B_y^2 \right) + \partial_y \left( B_y B_x \right), \frac{1}{2} \partial_y \left(B_y^2 - B_x^2 \right) + \partial_x \left( B_x B_y \right)\right)
\end{equation}

\begin{align*}
\nabla \cdot \mathbb{T} \left(x\right) = \frac{1}{\mu_0} \left( \partial_x B_x B_x - \partial_x B_y B_y + \partial_y B_y B_x + \partial_y B_x B_y \right) \numberthis \label{eq:17} \\
\nabla \cdot \mathbb{T} \left(y\right) = \frac{1}{\mu_0} \left( \partial_y B_y B_y - \partial_y B_x B_x + \partial_x B_x B_y + \partial_x B_y B_x \right) \numberthis \label{eq:18} \\
\end{align*}

\section{Weak formulation}


\begin{equation} \label{eq:19}
\begin{split}
\int_{\Omega} \nabla \times \left( \frac{1}{\mu} \left( \nabla \times \bm{A} \right) \right) \bm{\varphi} \,\mathrm{d}S &= \int_{\Omega} \frac{1}{\mu} \left( \nabla \times \bm{A} \right) \left( \nabla \times \bm{\varphi} \right) \,\mathrm{d}S - \\
&-\int_{\partial\Omega} \frac{1}{\mu} \left( \bm{n} \times \left( \nabla \times \bm{A} \right) \right) \bm{\varphi} \,\mathrm{d}l
\end{split}
\end{equation}

\noindent $\bm{\varphi} \in f \left(\Omega\right) : \bm{\varphi} \rvert_{\partial\Omega} = 0 \rightarrow -\int_{\partial\Omega} \frac{1}{\mu} \left( \bm{n} \times \left( \nabla \times \bm{A} \right) \right) \bm{\varphi} \,\mathrm{d}l = 0$

\begin{align*}
\bm{A}\left(x,y,t\right) \approx \sum_{n=1}^{N} A^n \left(t\right) \lambda^n \left(x,y\right) \numberthis \label{eq:20} \\
\bm{J}\left(x,y,t\right) \approx \sum_{n=1}^{N} J^n \left(t\right) \lambda^n \left(x,y\right) \numberthis \label{eq:21} \\
\bm{\varphi}\left(x,y,t\right) \approx \sum_{n=1}^{N} \varphi^n \left(t\right) \lambda^n \left(x,y\right) \numberthis \label{eq:22} \\
\end{align*}

\begin{equation} \label{eq:23}
\int_{\Omega} \frac{1}{\mu} \left( \nabla \times \bm{A} \right) \left( \nabla \times \bm{\varphi} \right) \,\mathrm{d}S \approx \sum_{n=1}^{N} \int_{T_n} \frac{1}{\mu} A^n \left( \nabla \times \lambda^n \right) \varphi^m \left( \nabla \times \lambda^m \right)\,\mathrm{d}S 
\end{equation}

\begin{equation} \label{eq:24}
\int_{\Omega} \bm{J} \bm{\varphi} \,\mathrm{d}S \approx \sum_{n=1}^{N} \int_{T_n} J^n \lambda^n \varphi^m \lambda^m \,\mathrm{d}S
\end{equation}

\section{Magnetostatic case}

\begin{equation} \label{eq:25}
\sum_{n=1}^{N} \int_{T_n} \frac{1}{\mu} A^n \left( \nabla \times \lambda^n \right) \left( \nabla \times \lambda^m \right)\,\mathrm{d}S  = \sum_{n=1}^{N} \int_{T_n} J^n \lambda^n \lambda^m \,\mathrm{d}S
\end{equation}

\begin{equation} \label{eq:26}
\frac{1}{\mu} \left[ S  \right] \left[ A \right] = \left[ M  \right] \left[ J \right]
\end{equation}

\begin{align*}
\left( \nabla \times \lambda^n \right) \left( \nabla \times \lambda^m \right) = \left(\partial_y \lambda^n, - \partial_x \lambda^n\right) \left(\partial_y \lambda^m, - \partial_x \lambda^m\right) \numberthis \label{eq:27} \\
\left(\partial_y \lambda^n, - \partial_x \lambda^n\right) \left(\partial_y \lambda^m, - \partial_x \lambda^m\right) = \partial_y \lambda^n \partial_y \lambda^m + \partial_x \lambda^n \partial_x \lambda^m  \numberthis \label{eq:28} \\
\left[ S  \right]_{T_n} = \left[ S_y \right]_{T_n} + \left[ S_x \right]_{T_n} = \int_{T_n} \left( \partial_y \lambda^n \partial_y \lambda^m \right) \,\mathrm{d}S + \int_{T_n} \left( \partial_x \lambda^n \partial_x \lambda^m \right) \,\mathrm{d}S \numberthis \label{eq:29} \\
\end{align*}

\noindent Basis functions on reference triangle $(r,s,t)$

\begin{align*}
\beta_1 &= 1 - r - s \numberthis \label{eq:30} \\
\beta_2 &= r \numberthis \label{eq:29} \\
\beta_3 &= s \numberthis \label{eq:31} \\
\end{align*}

\begin{equation} \label{eq:32}
\left[\partial \beta\right] = \begin{pmatrix} \partial_r \beta_1 & \partial_r \beta_2 & \partial_r \beta_3 \\ \partial_s \beta_1 & \partial_s \beta_2 & \partial_s \beta_3 \\ \end{pmatrix} =  \begin{pmatrix} -1 & 1 & 0 \\ -1 & 0 & 1 \\ \end{pmatrix}
\end{equation}

\noindent Coordinate transformation

\begin{equation} \label{eq:33}
\Phi \begin{pmatrix} x \\ y \\ \end{pmatrix} = \begin{pmatrix} x_1 \\ y_1 \\ \end{pmatrix} + \begin{pmatrix} x_2 - x_1 & x_3 - x_1  \\ y_2 - y_1 & y_3 - y_1 \\ \end{pmatrix} \begin{pmatrix} r \\ s \\ \end{pmatrix}
\end{equation}

\begin{align*}
\begin{pmatrix} x \\ y \\ \end{pmatrix} &= \Phi \begin{pmatrix} r \\ s \\ \end{pmatrix} \numberthis \label{eq:34} \\
\begin{pmatrix} r \\ s \\ \end{pmatrix} &= \Phi^{-1} \begin{pmatrix} x \\ y \\ \end{pmatrix} \numberthis \label{eq:35} \\
\lambda\left(x,y\right) &= \left( \beta \circ \Phi^{-1}\right) \left(x,y\right) \numberthis \label{eq:36} \\
\end{align*}

\begin{align*}
\vert \mathrm{det} \left(\nabla \Phi \right) \vert = \left| \mathrm{det} \begin{pmatrix} x_2 - x_1 & x_3 - x_1  \\ y_2 - y_1 & y_3 - y_1 \\ \end{pmatrix} \right| \numberthis \label{eq:37} \\
\left(\nabla \Phi \right)^{-1} = \frac{1}{\vert \mathrm{det} \left(\nabla \Phi \right) \vert} \begin{pmatrix} y_3 - y_1  &    -\left(x_3 - x_1\right) \\ -\left( y_2 - y_1 \right) & x_2 - x_1 \\ \end{pmatrix}  \numberthis \label{eq:38} \\
\end{align*}



\begin{equation} \label{eq:37}
\left[ S_y \right]_{T_n} = \int_{T_n} \left( \partial_y \lambda^n \partial_y \lambda^m \right) \,\mathrm{d}S =  \int_{T_n} \left( \partial_y \left( \beta^n \circ \Phi^{-1}\right) \partial_y \left( \beta^m \circ \Phi^{-1}\right) \right) \,\mathrm{d}S
\end{equation}

\begin{align*}
\partial_y \left( \beta^n \circ \Phi^{-1}\right) = \left( \partial_{\Phi^{-1}} \beta^n \right) \left( \partial_y \Phi^{-1} \right) \numberthis \label{eq:38} \\
\left[ S_y \right]_{T_n} = \int_{T_n} \left( \partial_{\Phi^{-1}} \beta^n \right) \left( \partial_y \Phi^{-1} \right) \left( \partial_{\Phi^{-1}} \beta^m \right) \left( \partial_y \Phi^{-1} \right) \,\mathrm{d}S  \numberthis \label{eq:39} \\
\left[ S_y \right]_{T_r} = \vert \mathrm{det} \left(\nabla \Phi \right) \vert \left(0,1\right)  \int_{T_r} \left[\partial \beta\right]  \left(\nabla \Phi \right)^{-1} \,\mathrm{d}S  \numberthis \label{eq:40} \\
\end{align*}

\begin{align*}
\left[ S_x \right]_{T_r} &= \frac{1}{2} \left(1,0\right) \left[\partial \beta\right]  \left(\nabla \Phi \right)^{-1} \vert \mathrm{det} \left(\nabla \Phi \right) \vert  \numberthis \label{eq:41} \\
\left[ S_y \right]_{T_r} &= \frac{1}{2} \left(0,1\right) \left[\partial \beta\right]  \left(\nabla \Phi \right)^{-1} \vert \mathrm{det} \left(\nabla \Phi \right) \vert \numberthis \label{eq:42} \\
\end{align*}

\noindent LocalMatrices.m

\verb|edet| = $\vert \mathrm{det} \left(\nabla \Phi \right) \vert$

\verb|dFinv| = $\left(\nabla \Phi \right)^{-1}$

\verb|dphi| = $\left(\nabla \Phi \right)^{-1} \left[\partial \beta\right]$

\verb|slocxx| = $\left[ S_x \right]_{T_r}$ = \verb|1/2 * dphi(1,:)' * dphi(1,:) * edet|

\verb|slocyy| = $\left[ S_y \right]_{T_r}$ = \verb|1/2 * dphi(2,:)' * dphi(2,:) * edet|


%\left[ S_x \right]_{T_r} &= \vert \mathrm{det} \left(\nabla \Phi \right) \vert \int_{T_r} \left( \partial_y \beta^n \left(x,y\right) \partial_y \beta^m \left(x,y\right) \right) \,\mathrm{d}S  \numberthis \label{eq:36} \\
%\left[ S_y \right]_{T_r} &= \vert \mathrm{det} \left(\nabla \Phi \right) \vert \int_{T_r} \left( \partial_x \beta^n \left(x,y\right) \partial_x \beta^m \left(x,y\right) \right) \,\mathrm{d}S  \numberthis \label{eq:37} \\






