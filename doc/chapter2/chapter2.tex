\newpage
\chapter{Weak formulation}

\begin{equation} \label{eq:19}
\begin{split}
\int_{\Omega} \nabla \times \left( \frac{1}{\mu} \left( \nabla \times \bm{A} \right) \right) \bm{\varphi} \,\mathrm{d}S &= \int_{\Omega} \frac{1}{\mu} \left( \nabla \times \bm{A} \right) \left( \nabla \times \bm{\varphi} \right) \,\mathrm{d}S - \\
&-\int_{\partial\Omega} \frac{1}{\mu} \left( \bm{n} \times \left( \nabla \times \bm{A} \right) \right) \bm{\varphi} \,\mathrm{d}l
\end{split}
\end{equation}

\noindent $\bm{\varphi} \in f \left(\Omega\right) : \bm{\varphi} \rvert_{\partial\Omega} = 0 \rightarrow -\int_{\partial\Omega} \frac{1}{\mu} \left( \bm{n} \times \left( \nabla \times \bm{A} \right) \right) \bm{\varphi} \,\mathrm{d}l = 0$

\begin{align*}
\bm{A}\left(x,y,t\right) \approx \sum_{n=1}^{N} A^n \left(t\right) \lambda^n \left(x,y\right) \numberthis \label{eq:20} \\
\bm{J}\left(x,y,t\right) \approx \sum_{n=1}^{N} J^n \left(t\right) \lambda^n \left(x,y\right) \numberthis \label{eq:21} \\
\bm{\varphi}\left(x,y,t\right) \approx \sum_{n=1}^{N} \varphi^n \left(t\right) \lambda^n \left(x,y\right) \numberthis \label{eq:22} \\
\end{align*}

\begin{equation} \label{eq:23}
\int_{\Omega} \frac{1}{\mu} \left( \nabla \times \bm{A} \right) \left( \nabla \times \bm{\varphi} \right) \,\mathrm{d}S \approx \sum_{n=1}^{N} \int_{T_n} \frac{1}{\mu} A^n \left( \nabla \times \lambda^n \right) \varphi^m \left( \nabla \times \lambda^m \right)\,\mathrm{d}S 
\end{equation}

\begin{equation} \label{eq:24}
\int_{\Omega} \bm{J} \bm{\varphi} \,\mathrm{d}S \approx \sum_{n=1}^{N} \int_{T_n} J^n \lambda^n \varphi^m \lambda^m \,\mathrm{d}S
\end{equation}

\section{Magnetostatic case}

\begin{equation} \label{eq:25}
\sum_{n=1}^{N} \int_{T_n} \frac{1}{\mu} A^n \left( \nabla \times \lambda^n \right) \left( \nabla \times \lambda^m \right)\,\mathrm{d}S  = \sum_{n=1}^{N} \int_{T_n} J^n \lambda^n \lambda^m \,\mathrm{d}S
\end{equation}

\begin{equation} \label{eq:26}
\frac{1}{\mu} \left[ S  \right] \left[ A \right] = \left[ M  \right] \left[ J \right]
\end{equation}

\begin{align*}
\left( \nabla \times \lambda^n \right) \left( \nabla \times \lambda^m \right) = \left(\partial_y \lambda^n, - \partial_x \lambda^n\right) \left(\partial_y \lambda^m, - \partial_x \lambda^m\right) \numberthis \label{eq:27} \\
\left(\partial_y \lambda^n, - \partial_x \lambda^n\right) \left(\partial_y \lambda^m, - \partial_x \lambda^m\right) = \partial_y \lambda^n \partial_y \lambda^m + \partial_x \lambda^n \partial_x \lambda^m  \numberthis \label{eq:28} \\
\left[ S  \right]_{T_n} = \left[ S_y \right]_{T_n} + \left[ S_x \right]_{T_n} = \int_{T_n} \left( \partial_y \lambda^n \partial_y \lambda^m \right) \,\mathrm{d}S + \int_{T_n} \left( \partial_x \lambda^n \partial_x \lambda^m \right) \,\mathrm{d}S \numberthis \label{eq:29} \\
\end{align*}

\noindent Basis functions on reference triangle $(r,s,t)$

\begin{align*}
\beta_1 &= 1 - r - s \numberthis \label{eq:30} \\
\beta_2 &= r \numberthis \label{eq:29} \\
\beta_3 &= s \numberthis \label{eq:31} \\
\end{align*}

\begin{equation} \label{eq:32}
\left[\partial \beta\right] = \begin{pmatrix} \partial_r \beta_1 & \partial_r \beta_2 & \partial_r \beta_3 \\ \partial_s \beta_1 & \partial_s \beta_2 & \partial_s \beta_3 \\ \end{pmatrix} =  \begin{pmatrix} -1 & 1 & 0 \\ -1 & 0 & 1 \\ \end{pmatrix}
\end{equation}

\noindent Coordinate transformation

\begin{equation} \label{eq:33}
\Phi \begin{pmatrix} x \\ y \\ \end{pmatrix} = \begin{pmatrix} x_1 \\ y_1 \\ \end{pmatrix} + \begin{pmatrix} x_2 - x_1 & x_3 - x_1  \\ y_2 - y_1 & y_3 - y_1 \\ \end{pmatrix} \begin{pmatrix} r \\ s \\ \end{pmatrix}
\end{equation}

\begin{align*}
\begin{pmatrix} x \\ y \\ \end{pmatrix} &= \Phi \begin{pmatrix} r \\ s \\ \end{pmatrix} \numberthis \label{eq:34} \\
\begin{pmatrix} r \\ s \\ \end{pmatrix} &= \Phi^{-1} \begin{pmatrix} x \\ y \\ \end{pmatrix} \numberthis \label{eq:35} \\
\lambda\left(x,y\right) &= \left( \beta \circ \Phi^{-1}\right) \left(x,y\right) \numberthis \label{eq:36} \\
\end{align*}

\begin{align*}
\vert \mathrm{det} \left(\nabla \Phi \right) \vert = \left| \mathrm{det} \begin{pmatrix} x_2 - x_1 & x_3 - x_1  \\ y_2 - y_1 & y_3 - y_1 \\ \end{pmatrix} \right| \numberthis \label{eq:37} \\
\left(\nabla \Phi \right)^{-1} = \frac{1}{\vert \mathrm{det} \left(\nabla \Phi \right) \vert} \begin{pmatrix} y_3 - y_1  &    -\left(x_3 - x_1\right) \\ -\left( y_2 - y_1 \right) & x_2 - x_1 \\ \end{pmatrix}  \numberthis \label{eq:38} \\
\end{align*}

\begin{equation} \label{eq:37}
\left[ S_y \right]_{T_n} = \int_{T_n} \left( \partial_y \lambda^n \partial_y \lambda^m \right) \,\mathrm{d}S =  \int_{T_n} \left( \partial_y \left( \beta^n \circ \Phi^{-1}\right) \partial_y \left( \beta^m \circ \Phi^{-1}\right) \right) \,\mathrm{d}S
\end{equation}

\begin{align*}
\partial_y \left( \beta^n \circ \Phi^{-1}\right) = \left( \partial_{\Phi^{-1}} \beta^n \right) \left( \partial_y \Phi^{-1} \right) \numberthis \label{eq:38} \\
\left[ S_y \right]_{T_n} = \int_{T_n} \left( \partial_{\Phi^{-1}} \beta^n \right) \left( \partial_y \Phi^{-1} \right) \left( \partial_{\Phi^{-1}} \beta^m \right) \left( \partial_y \Phi^{-1} \right) \,\mathrm{d}S  \numberthis \label{eq:39} \\
\left[ S_y \right]_{T_r} = \vert \mathrm{det} \left(\nabla \Phi \right) \vert \left(0,1\right)  \int_{T_r} \left[\partial \beta\right]  \left(\nabla \Phi \right)^{-1} \,\mathrm{d}S  \numberthis \label{eq:40} \\
\end{align*}

\begin{align*}
\left[ S_x \right]_{T_r} &= \frac{1}{2} \left(1,0\right) \left[\partial \beta\right]  \left(\nabla \Phi \right)^{-1} \vert \mathrm{det} \left(\nabla \Phi \right) \vert  \numberthis \label{eq:41} \\
\left[ S_y \right]_{T_r} &= \frac{1}{2} \left(0,1\right) \left[\partial \beta\right]  \left(\nabla \Phi \right)^{-1} \vert \mathrm{det} \left(\nabla \Phi \right) \vert \numberthis \label{eq:42} \\
\end{align*}

\noindent LocalMatrices.m

\verb|edet| = $\vert \mathrm{det} \left(\nabla \Phi \right) \vert$

\verb|dFinv| = $\left(\nabla \Phi \right)^{-1}$

\verb|dphi| = $\left(\nabla \Phi \right)^{-1} \left[\partial \beta\right]$

\verb|slocxx| = $\left[ S_x \right]_{T_r}$ = \verb|1/2 * dphi(1,:)' * dphi(1,:) * edet|

\verb|slocyy| = $\left[ S_y \right]_{T_r}$ = \verb|1/2 * dphi(2,:)' * dphi(2,:) * edet|


%\left[ S_x \right]_{T_r} &= \vert \mathrm{det} \left(\nabla \Phi \right) \vert \int_{T_r} \left( \partial_y \beta^n \left(x,y\right) \partial_y \beta^m \left(x,y\right) \right) \,\mathrm{d}S  \numberthis \label{eq:36} \\
%\left[ S_y \right]_{T_r} &= \vert \mathrm{det} \left(\nabla \Phi \right) \vert \int_{T_r} \left( \partial_x \beta^n \left(x,y\right) \partial_x \beta^m \left(x,y\right) \right) \,\mathrm{d}S  \numberthis \label{eq:37} \\






